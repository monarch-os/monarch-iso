#!/bin/bash

if [ $# -eq 0 ]; then
  echo "usage: monarch-iso-sign [release/monarch.iso]"
  exit 1
fi

if ! pacman -Q gnupg >/dev/null; then
  sudo pacman -S --noconfirm --needed --quiet gnupg
  echo "You'll need to import key with: gpg --import path/to/signing-key.asc"
fi

gnupg_user_key=$(gpg --list-secret-keys --keyid-format=long | awk '/^[[:space:]]/{print $1; exit}')
gpg --local-user "$gnupg_user_key" --output $1.sig --detach-sig $1
